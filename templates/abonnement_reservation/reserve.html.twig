{% extends 'basef.html.twig' %}

{% block title %}Reserve Subscription{% endblock %}

{% block styles %}
<style>
    .reservation-detail-card {
        background-color: #f8f9fa;
        border-radius: 0.75rem;
    }
    .form-control {
        transition: all 0.3s ease;
    }
    .form-control:focus {
        box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.5);
    }
</style>
{% endblock %}

{% block body %}
<div class="w-full px-6 py-6 mx-auto">
    <div class="flex flex-wrap -mx-3">
        <div class="w-full max-w-full px-3 lg:w-8/12 lg:flex-none">
            <div class="relative flex flex-col min-w-0 break-words bg-white border-0 shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">
                <div class="p-6 pb-0 mb-0 border-b-0 rounded-t-2xl">
                    <h3 class="text-xl font-bold dark:text-white">Reserve {{ abonnement.type|capitalize }} Subscription</h3>
                </div>
                
                {% for message in app.flashes('danger') %}
                    <div class="p-4 mx-6 mt-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}

                <div class="flex-auto p-6">
                    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                        <div class="p-6 reservation-detail-card dark:bg-slate-800">
                            <h5 class="mb-4 text-lg font-bold dark:text-white">Subscription Details</h5>
                            <ul class="space-y-3 text-slate-600 dark:text-white/80">
                                <li class="flex items-center">
                                    <span class="mr-2 font-semibold">Type:</span>
                                    <span>{{ abonnement.type|capitalize }}</span>
                                </li>
                                <li class="flex items-center">
                                    <span class="mr-2 font-semibold">Price:</span>
                                    <span class="text-blue-500">{{ abonnement.prix }} DT</span>
                                </li>
                                <li class="flex items-center">
                                    <span class="mr-2 font-semibold">Duration:</span>
                                    <span>1 month</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="p-6 reservation-detail-card dark:bg-slate-800">
                            <h5 class="mb-4 text-lg font-bold dark:text-white">Reservation Period</h5>
                            <ul class="space-y-3 text-slate-600 dark:text-white/80">
                                <li class="flex items-center">
                                    <span class="mr-2 font-semibold">Start Date:</span>
                                    <span>{{ "now"|date_modify("+1 day")|date('d/m/Y') }}</span>
                                </li>
                                <li class="flex items-center">
                                    <span class="mr-2 font-semibold">End Date:</span>
                                    <span>{{ "now"|date_modify("+1 month +1 day")|date('d/m/Y') }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    {{ form_start(form, {'attr': {'id': 'reservation-form'}}) }}
                        <div class="mb-4">
                            <label class="inline-block mb-2 ml-1 text-xs font-bold text-slate-700 dark:text-white/80">Full Name</label>
                            {{ form_widget(form.fullname, {
                                'attr': {
                                    'class': 'focus:shadow-soft-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease-soft block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none'
                                }
                            }) }}
                        </div>

                        {{ form_rest(form) }}

                        <div class="flex justify-end mt-8 space-x-4">
                            <a href="{{ path('app_abonnement_index') }}" 
                               class="inline-block px-6 py-3 text-sm font-bold text-center text-gray-700 uppercase align-middle transition-all bg-transparent border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-100 active:bg-gray-200 hover:shadow-xs ease-soft-in leading-pro tracking-tight-soft shadow-soft-md bg-150 bg-x-25">
                                Cancel
                            </a>
                            <button id="stripe-checkout-btn"
                                    type="button"
                                    class="inline-block px-6 py-3 text-sm font-bold text-center text-white uppercase align-middle transition-all bg-blue-500 border-0 rounded-lg cursor-pointer hover:bg-blue-600 active:bg-blue-700 hover:shadow-xs ease-soft-in leading-pro tracking-tight-soft shadow-soft-md bg-150 bg-x-25">
                                Pay & Confirm
                            </button>
                        </div>
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe('{{ stripe_key }}');  {# Fixed: Removed $ prefix #}

    document.getElementById('stripe-checkout-btn').addEventListener('click', function () {
        document.getElementById('reservation-form').submit();
    });
</script>
{% endblock %}