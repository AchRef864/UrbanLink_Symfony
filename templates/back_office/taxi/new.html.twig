{% block title %}Ajouter Taxi{% endblock %}

{% block body %}
  <h1 class="text-2xl font-bold mb-4">Ajouter un nouveau Taxi</h1>

  {{ form_start(form) }}
    <div class="mb-4">
      {{ form_label(form.immatriculation) }}
      {{ form_widget(form.immatriculation, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.immatriculation) }}
    </div>
    <div class="mb-4">
      {{ form_label(form.marque) }}
      {{ form_widget(form.marque, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.marque) }}
    </div>
    <div class="mb-4">
      {{ form_label(form.modele) }}
      {{ form_widget(form.modele, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.modele) }}
    </div>
    <div class="mb-4">
      {{ form_label(form.anneeFabrication) }}
      {{ form_widget(form.anneeFabrication, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.anneeFabrication) }}
    </div>
    <div class="mb-4">
      {{ form_label(form.capacite) }}
      {{ form_widget(form.capacite, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.capacite) }}
    </div>
    <div class="mb-4">
      {{ form_label(form.zoneDesserte) }}
      {{ form_widget(form.zoneDesserte, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.zoneDesserte) }}
    </div>
    <div class="mb-4">
      {{ form_label(form.statut) }}
      {{ form_widget(form.statut, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.statut) }}
    </div>
    <div class="mb-4">
      {{ form_label(form.licenceNumero) }}
      {{ form_widget(form.licenceNumero, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.licenceNumero) }}
    </div>
    <div class="mb-4">
      {{ form_label(form.licenceDateObtention) }}
      {{ form_widget(form.licenceDateObtention, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.licenceDateObtention) }}
    </div>
    <div class="mb-4">
      {{ form_label(form.tarifBase) }}
      {{ form_widget(form.tarifBase, {'attr': {'class': 'border p-2 w-full'}}) }}
      {{ form_errors(form.tarifBase) }}
    </div>

    <!-- Bouton Ajouter Taxi -->
    <div class="mt-6">
      <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        Ajouter Taxi
      </button>
    </div>
  {{ form_end(form) }}

  <!-- Script pour la mise à jour dynamique -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
      $(document).ready(function () {
          $('#taxi_marque').change(function () {
              const marque = $(this).val();
              const modeleField = $('#taxi_modele');

              if (marque) {
                  $.ajax({
                      url: '{{ path("get_models") }}',
                      method: 'POST',
                      data: { marque: marque },
                      success: function (data) {
                          modeleField.empty();
                          modeleField.append('<option value="">Choisissez un modèle</option>');
                          data.forEach(function (model) {
                              modeleField.append('<option value="' + model + '">' + model + '</option>');
                          });
                      },
                      error: function () {
                          alert('Une erreur est survenue lors du chargement des modèles.');
                      }
                  });
              } else {
                  modeleField.empty();
                  modeleField.append('<option value="">Choisissez d\'abord une marque</option>');
              }
          });
      });
  </script>
{% endblock %}