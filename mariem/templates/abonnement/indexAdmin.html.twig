{# templates/abonnement/indexAdmin.html.twig #}
{% extends 'admin.html.twig' %}

{% block body %}
    <div class="container mx-auto px-4">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-2xl font-bold dark:text-white">Liste des abonnements</h1>
            <a href="{{ path('add_abonnement') }}" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                <i class="fas fa-plus mr-2"></i> Ajouter un abonnement
            </a>
        </div>

        {% if abonnements is empty %}
            <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-4">
                <p>Aucun abonnement trouvé</p>
            </div>
        {% else %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for abonnement in abonnements %}
                    <div class="relative flex flex-col min-w-0 break-words bg-white shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">
                        {% if abonnement.image %}
                            <img src="{{ asset('uploads/' ~ abonnement.image) }}" class="w-full h-48 object-cover rounded-t-2xl" alt="{{ abonnement.type }}">
                        {% endif %}
                        
                        <div class="flex-auto p-4">
                            <div class="flex flex-col">
                                <div class="mb-4">
                                    <h5 class="text-xl font-bold dark:text-white">{{ abonnement.type }}</h5>
                                    <div class="mt-2 space-y-1">
                                        <p class="text-sm dark:text-white dark:opacity-80">
                                            <span class="font-semibold">Prix:</span> {{ abonnement.prix }} €
                                        </p>
                                        <p class="text-sm dark:text-white dark:opacity-80">
                                            <span class="font-semibold">Date début:</span> {{ abonnement.dateDebut|date('d/m/Y') }}
                                        </p>
                                        <p class="text-sm dark:text-white dark:opacity-80">
                                            <span class="font-semibold">Date fin:</span> {{ abonnement.dateFin|date('d/m/Y') }}
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="mt-auto">
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs font-semibold px-2 py-1 rounded 
                                            {% if abonnement.etat == 'actif' %}bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100
                                            {% elseif abonnement.etat == 'expiré' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100
                                            {% else %}bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100
                                            {% endif %}">
                                            {{ abonnement.etat }}
                                        </span>
                                        
                                        <div class="flex space-x-2">
                                            <a href="{{ path('update_ab', {'id': abonnement.id}) }}" class="inline-flex items-center px-3 py-1 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                                <i class="fas fa-edit mr-1"></i> Modifier
                                            </a>
                                            
                                      <form method="POST" action="{{ path('delete_ab', {'id': abonnement.id}) }}" class="delete-form">
    <input type="hidden" name="_method" value="DELETE">
    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ abonnement.id) }}">
    <button type="button" class="delete-btn inline-flex items-center px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm">
        <i class="fas fa-trash mr-1"></i> Supprimer
    </button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Delete confirmation with SweetAlert2
    document.querySelectorAll('.delete-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const form = this.closest('form');
            
            Swal.fire({
                title: 'Confirmer la suppression',
                text: "Voulez-vous vraiment supprimer cet abonnement?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Oui, supprimer',
                cancelButtonText: 'Annuler',
                buttonsStyling: false,
                customClass: {
                    confirmButton: 'px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white mr-2 transition-colors',
                    cancelButton: 'px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-800 transition-colors'
                },
                reverseButtons: true,
                backdrop: `
                    rgba(0,0,0,0.4)
                    url("${'{{ asset("images/trash-icon.png") }}'}")
                    left top
                    no-repeat
                `
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });
        });
    });
});
</script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>




                    <script>
function submitDeleteForm(form) {
    fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
    }).then(response => {
        if (response.redirected) {
            window.location.href = response.url;
        }
    });
    return false;
}
</script>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endblock %}